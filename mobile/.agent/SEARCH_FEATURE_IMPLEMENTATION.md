# æœç´¢åŠŸèƒ½å®Œæ•´å®ç°æŒ‡å—

**ç‰ˆæœ¬**: v1.2.0  
**åˆ›å»ºæ—¶é—´**: 2026-01-16  
**çŠ¶æ€**: å¾…å®ç°

---

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [å‰ç«¯å®ç°](#å‰ç«¯å®ç°)
4. [åç«¯å®ç°](#åç«¯å®ç°)
5. [æµ‹è¯•æ¸…å•](#æµ‹è¯•æ¸…å•)
6. [å·²çŸ¥é—®é¢˜](#å·²çŸ¥é—®é¢˜)

---

## åŠŸèƒ½æ¦‚è¿°

### ç”¨æˆ·åœºæ™¯

> "æˆ‘è®°å¾—ä¸Šä¸ªæœˆå†™è¿‡å…³äºæ—…è¡Œçš„æ—¥è®°ï¼Œä½†å¿˜äº†å…·ä½“æ—¥æœŸã€‚æˆ‘æƒ³æœç´¢'æ—…è¡Œ'æ‰¾åˆ°é‚£æ¡æ—¥è®°ã€‚"

### æ ¸å¿ƒåŠŸèƒ½

- âœ… å®æ—¶æœç´¢ï¼ˆè¾“å…¥å³æœï¼‰
- âœ… æ”¯æŒä¸­è‹±æ–‡æ¨¡ç³ŠåŒ¹é…
- âœ… æœç´¢æ ‡é¢˜å’Œå†…å®¹ï¼ˆä¸æœç´¢AIåé¦ˆï¼‰
- âœ… æœ¬åœ°æœç´¢ + åç«¯å…¨æ–‡æœç´¢
- âœ… æœç´¢ç»“æœé«˜äº®æ˜¾ç¤º
- âœ… æŒ‰ç›¸å…³æ€§å’Œæ—¶é—´æ’åº

### æŠ€æœ¯è¦æ±‚

- å‰ç«¯ï¼šReact Native + TypeScript
- åç«¯ï¼šPython FastAPI + DynamoDB
- é˜²æŠ–ï¼š300ms
- æ”¯æŒç‰¹æ®Šå­—ç¬¦å’Œemoji

---

## æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¾“å…¥   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜²æŠ– 300ms â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯æœ¬åœ°æœç´¢ï¼ˆå·²åŠ è½½æ—¥è®°ï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯å…¨æ–‡æœç´¢ï¼ˆæ‰€æœ‰æ—¥è®°ï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆå¹¶ç»“æœå¹¶å»é‡              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¸²æŸ“æœç´¢ç»“æœï¼ˆå¸¦é«˜äº®ï¼‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å‰ç«¯å®ç°

### æ­¥éª¤ 1: æ·»åŠ æœç´¢UI

#### æ–‡ä»¶: `mobile/src/screens/DiaryListScreen.tsx`

**ä½ç½®**: åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ å¯¼å…¥

```typescript
import { TextInput } from "react-native"; // æ·»åŠ åˆ°ç°æœ‰å¯¼å…¥ä¸­
```

**ä½ç½®**: åœ¨ state å®šä¹‰åŒºåŸŸï¼ˆçº¦ç¬¬113è¡Œé™„è¿‘ï¼‰æ·»åŠ 

```typescript
// æœç´¢ç›¸å…³çŠ¶æ€
const [searchQuery, setSearchQuery] = useState("");
const [searchResults, setSearchResults] = useState<Diary[]>([]);
const [isSearching, setIsSearching] = useState(false);
const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);
```

**ä½ç½®**: ä¿®æ”¹ `renderHeader` å‡½æ•°ï¼ˆçº¦ç¬¬1208è¡Œï¼‰

åœ¨æ±‰å ¡èœå•è¡Œï¼ˆ`</View>`ï¼Œçº¦ç¬¬1221è¡Œï¼‰**ä¹‹å**ã€é¡¶éƒ¨åŒºåŸŸï¼ˆ`<View style={styles.topBar}>`ï¼Œçº¦ç¬¬1224è¡Œï¼‰**ä¹‹å‰**æ·»åŠ ï¼š

```typescript
{/* æœç´¢æ¡† - ç‹¬ç«‹ä¸€è¡Œï¼Œæ”¾åœ¨æ±‰å ¡èœå•å’Œé—®å€™è¯­ä¹‹é—´ */}
<View style={styles.searchContainer}>
  <View style={styles.searchInputWrapper}>
    <Ionicons
      name="search-outline"
      size={20}
      color="#80645A"
      style={styles.searchIcon}
    />
    <TextInput
      style={[
        styles.searchInput,
        {
          fontFamily: getFontFamilyForText(
            searchQuery || t('search.placeholder'),
            'regular'
          )
        }
      ]}
      placeholder={t('search.placeholder')}
      placeholderTextColor="#B8A89D"
      value={searchQuery}
      onChangeText={handleSearchChange}
      returnKeyType="search"
      autoCapitalize="none"
      autoCorrect={false}
      clearButtonMode="while-editing" // iOSæ¸…ç©ºæŒ‰é’®
    />
    {/* Androidæ¸…ç©ºæŒ‰é’® */}
    {Platform.OS === 'android' && searchQuery.length > 0 && (
      <TouchableOpacity
        onPress={() => {
          setSearchQuery('');
          setSearchResults([]);
          setIsSearching(false);
        }}
        hitSlop={{ top: 10, bottom: 10, left: 10, right: 10 }}
        style={styles.clearButton}
      >
        <Ionicons name="close-circle" size={20} color="#B8A89D" />
      </TouchableOpacity>
    )}
  </View>

  {/* æœç´¢çŠ¶æ€æç¤º */}
  {isSearching && (
    <View style={styles.searchingIndicator}>
      <ActivityIndicator size="small" color="#80645A" />
      <Text style={styles.searchingText}>{t('search.searching')}</Text>
    </View>
  )}

  {/* æœç´¢ç»“æœæ•°é‡ */}
  {searchQuery.trim() !== '' && !isSearching && (
    <Text style={styles.searchResultCount}>
      {searchResults.length === 0
        ? t('search.noResults')
        : `${t('search.found')} ${searchResults.length} ${t('search.results')}`
      }
    </Text>
  )}
</View>
```

**ä½ç½®**: æ·»åŠ æ ·å¼ï¼ˆåœ¨ `styles = StyleSheet.create({` å¯¹è±¡ä¸­ï¼Œçº¦ç¬¬1924è¡Œï¼‰

```typescript
// æœç´¢ç›¸å…³æ ·å¼
searchContainer: {
  marginTop: 16,
  marginBottom: 8,
},
searchInputWrapper: {
  flexDirection: 'row',
  alignItems: 'center',
  backgroundColor: '#F8F4F0',
  borderRadius: 12,
  paddingHorizontal: 16,
  paddingVertical: Platform.OS === 'ios' ? 12 : 8,
  borderWidth: 1,
  borderColor: '#E8DED0',
},
searchIcon: {
  marginRight: 8,
},
searchInput: {
  flex: 1,
  fontSize: 16,
  color: '#332824',
  paddingVertical: Platform.OS === 'ios' ? 0 : 4,
  height: Platform.OS === 'android' ? 40 : undefined,
},
clearButton: {
  marginLeft: 8,
},
searchingIndicator: {
  flexDirection: 'row',
  alignItems: 'center',
  marginTop: 8,
  gap: 8,
},
searchingText: {
  fontSize: 14,
  color: '#80645A',
},
searchResultCount: {
  fontSize: 14,
  color: '#80645A',
  marginTop: 8,
},
```

---

### æ­¥éª¤ 2: å®ç°æœç´¢é€»è¾‘

**ä½ç½®**: åœ¨ `DiaryListScreen` ç»„ä»¶å†…ï¼Œ`handleDeleteDiary` å‡½æ•°åé¢ï¼ˆçº¦ç¬¬1086è¡Œä¹‹åï¼‰

```typescript
// ========== æœç´¢ç›¸å…³å‡½æ•° ==========

/**
 * æœç´¢è¾“å…¥å˜åŒ–å¤„ç†ï¼ˆå¸¦é˜²æŠ–ï¼‰
 */
const handleSearchChange = (text: string) => {
  setSearchQuery(text);

  // æ¸…ç©ºè¾“å…¥æ—¶é‡ç½®
  if (text.trim() === "") {
    setSearchResults([]);
    setIsSearching(false);
    if (searchTimeoutRef.current) {
      clearTimeout(searchTimeoutRef.current);
      searchTimeoutRef.current = null;
    }
    return;
  }

  // é˜²æŠ–ï¼šç­‰ç”¨æˆ·åœæ­¢è¾“å…¥300msåå†æœç´¢
  setIsSearching(true);

  if (searchTimeoutRef.current) {
    clearTimeout(searchTimeoutRef.current);
  }

  searchTimeoutRef.current = setTimeout(() => {
    performSearch(text.trim());
  }, 300);
};

/**
 * æ‰§è¡Œæœç´¢ï¼ˆæœ¬åœ° + åç«¯ï¼‰
 */
const performSearch = async (query: string) => {
  if (!query) {
    setSearchResults([]);
    setIsSearching(false);
    return;
  }

  try {
    console.log("ğŸ” å¼€å§‹æœç´¢:", query);
    const lowercaseQuery = query.toLowerCase();

    // 1. æœ¬åœ°æœç´¢ï¼ˆå·²åŠ è½½çš„æ—¥è®°ï¼‰
    const localResults = diaries.filter((diary) => {
      const title = (diary.title || "").toLowerCase();
      const originalContent = (diary.original_content || "").toLowerCase();
      const polishedContent = (diary.polished_content || "").toLowerCase();

      return (
        title.includes(lowercaseQuery) ||
        originalContent.includes(lowercaseQuery) ||
        polishedContent.includes(lowercaseQuery)
      );
    });

    console.log("ğŸ“ æœ¬åœ°æœç´¢ç»“æœ:", localResults.length);

    // 2. åç«¯å…¨æ–‡æœç´¢ï¼ˆæ‰€æœ‰æ—¥è®°ï¼ŒåŒ…æ‹¬æœªåŠ è½½çš„ï¼‰
    let backendResults: Diary[] = [];
    try {
      backendResults = await searchDiaries(query);
      console.log("ğŸŒ åç«¯æœç´¢ç»“æœ:", backendResults.length);
    } catch (backendError) {
      console.warn("âš ï¸ åç«¯æœç´¢å¤±è´¥ï¼Œä»…æ˜¾ç¤ºæœ¬åœ°ç»“æœ:", backendError);
      // é™çº§ï¼šåªä½¿ç”¨æœ¬åœ°ç»“æœ
    }

    // 3. åˆå¹¶ç»“æœå¹¶å»é‡ï¼ˆä¼˜å…ˆæœ¬åœ°ç»“æœï¼‰
    const mergedResults = mergeAndDeduplicateResults(
      localResults,
      backendResults,
    );

    console.log("âœ… æœ€ç»ˆæœç´¢ç»“æœ:", mergedResults.length);
    setSearchResults(mergedResults);
  } catch (error) {
    console.error("âŒ æœç´¢å¤±è´¥:", error);
    // å‘ç”Ÿé”™è¯¯æ—¶ä¹Ÿæ˜¾ç¤ºæœ¬åœ°æœç´¢ç»“æœ
    const localResults = diaries.filter((diary) => {
      const title = (diary.title || "").toLowerCase();
      const content = (
        diary.polished_content ||
        diary.original_content ||
        ""
      ).toLowerCase();
      return (
        title.includes(query.toLowerCase()) ||
        content.includes(query.toLowerCase())
      );
    });
    setSearchResults(localResults);
  } finally {
    setIsSearching(false);
  }
};

/**
 * åˆå¹¶å¹¶å»é‡æœç´¢ç»“æœ
 */
const mergeAndDeduplicateResults = (
  local: Diary[],
  backend: Diary[],
): Diary[] => {
  const seen = new Set<string>();
  const merged: Diary[] = [];

  // ä¼˜å…ˆæ·»åŠ æœ¬åœ°ç»“æœï¼ˆå·²åŠ è½½ï¼Œæ¸²æŸ“æ›´å¿«ï¼‰
  for (const diary of local) {
    if (!seen.has(diary.diary_id)) {
      seen.add(diary.diary_id);
      merged.push(diary);
    }
  }

  // æ·»åŠ åç«¯ç‹¬æœ‰çš„ç»“æœ
  for (const diary of backend) {
    if (!seen.has(diary.diary_id)) {
      seen.add(diary.diary_id);
      merged.push(diary);
    }
  }

  // æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åº
  merged.sort((a, b) => {
    const dateA = new Date(a.created_at).getTime();
    const dateB = new Date(b.created_at).getTime();
    return dateB - dateA;
  });

  return merged;
};
```

**ä½ç½®**: ä¿®æ”¹ `FlatList` çš„ `data` å±æ€§ï¼ˆçº¦ç¬¬1900è¡Œï¼‰

```typescript
<FlatList
  data={searchQuery.trim() !== '' ? searchResults : diaries}
  // ... å…¶ä»– props ä¿æŒä¸å˜
```

**ä½ç½®**: æ¸…ç†æœç´¢å®šæ—¶å™¨ï¼ˆåœ¨ `useEffect` æ¸…ç†å‡½æ•°ä¸­ï¼‰

åœ¨ç°æœ‰çš„ cleanup é€»è¾‘ä¸­ï¼ˆçº¦ç¬¬340è¡Œçš„ `useFocusEffect` æˆ–ç»„ä»¶å¸è½½æ—¶ï¼‰æ·»åŠ ï¼š

```typescript
// æ¸…ç†æœç´¢å®šæ—¶å™¨
return () => {
  if (searchTimeoutRef.current) {
    clearTimeout(searchTimeoutRef.current);
  }
  // ... å…¶ä»–æ¸…ç†é€»è¾‘
};
```

---

### æ­¥éª¤ 3: æ·»åŠ æœç´¢APIè°ƒç”¨

#### æ–‡ä»¶: `mobile/src/services/diaryService.ts`

**ä½ç½®**: åœ¨æ–‡ä»¶æœ«å°¾ï¼Œ`createTextDiary` å‡½æ•°ä¹‹åæ·»åŠ 

```typescript
/**
 * æœç´¢æ—¥è®°
 * @param query æœç´¢å…³é”®è¯
 * @returns åŒ¹é…çš„æ—¥è®°åˆ—è¡¨
 */
export async function searchDiaries(query: string): Promise<any[]> {
  try {
    const response = await axiosInstance.get("/api/diary/search", {
      params: { q: query },
    });

    console.log("ğŸ” æœç´¢APIå“åº”:", response.data);
    return response.data.diaries || [];
  } catch (error: any) {
    console.error("âŒ æœç´¢æ—¥è®°å¤±è´¥:", error);

    // å¦‚æœæ˜¯404æˆ–500ï¼Œè¿”å›ç©ºæ•°ç»„è€Œä¸æ˜¯æŠ›å‡ºé”™è¯¯
    if (error.response?.status === 404 || error.response?.status === 500) {
      console.warn("âš ï¸ åç«¯æœç´¢ä¸å¯ç”¨ï¼Œè¿”å›ç©ºç»“æœ");
      return [];
    }

    throw error;
  }
}
```

**é‡è¦**: ç¡®ä¿é¡¶éƒ¨å·²å¯¼å…¥ `axiosInstance`:

```typescript
import { axiosInstance } from "../config/aws-config";
```

---

### æ­¥éª¤ 4: åˆ›å»ºé«˜äº®ç»„ä»¶

#### æ–‡ä»¶: `mobile/src/components/HighlightedText.tsx` (æ–°å»ºæ–‡ä»¶)

```typescript
import React from 'react';
import { Text, TextStyle, StyleProp } from 'react-native';

interface HighlightedTextProps {
  /**
   * è¦æ˜¾ç¤ºçš„æ–‡æœ¬
   */
  text: string;

  /**
   * æœç´¢å…³é”®è¯ï¼ˆç”¨äºé«˜äº®ï¼‰
   */
  searchQuery: string;

  /**
   * æ–‡æœ¬æ ·å¼
   */
  style?: StyleProp<TextStyle>;

  /**
   * é«˜äº®éƒ¨åˆ†çš„æ ·å¼
   */
  highlightStyle?: StyleProp<TextStyle>;

  /**
   * æœ€å¤§è¡Œæ•°
   */
  numberOfLines?: number;
}

/**
 * å¸¦æœç´¢å…³é”®è¯é«˜äº®çš„æ–‡æœ¬ç»„ä»¶
 *
 * ç”¨æ³•:
 * <HighlightedText
 *   text="ä»Šå¤©å»äº†åŒ—äº¬æ—…è¡Œ"
 *   searchQuery="æ—…è¡Œ"
 *   style={styles.text}
 * />
 */
export function HighlightedText({
  text,
  searchQuery,
  style,
  highlightStyle,
  numberOfLines,
}: HighlightedTextProps) {
  // å¦‚æœæ²¡æœ‰æœç´¢è¯ï¼Œç›´æ¥æ˜¾ç¤ºåŸæ–‡
  if (!searchQuery || searchQuery.trim() === '') {
    return (
      <Text style={style} numberOfLines={numberOfLines}>
        {text}
      </Text>
    );
  }

  // å¦‚æœæ–‡æœ¬ä¸ºç©ºï¼Œè¿”å›ç©º
  if (!text) {
    return <Text style={style} numberOfLines={numberOfLines}></Text>;
  }

  try {
    // è½¬ä¹‰ç‰¹æ®Šæ­£åˆ™å­—ç¬¦
    const escapedQuery = searchQuery.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

    // åˆ†å‰²æ–‡æœ¬ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰
    const parts = text.split(new RegExp(`(${escapedQuery})`, 'gi'));

    return (
      <Text style={style} numberOfLines={numberOfLines}>
        {parts.map((part, index) => {
          // æ£€æŸ¥æ˜¯å¦åŒ¹é…ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰
          const isMatch = part.toLowerCase() === searchQuery.toLowerCase();

          return isMatch ? (
            <Text
              key={index}
              style={[
                highlightStyle || {
                  backgroundColor: '#FFE5B4', // æµ…æ©™è‰²èƒŒæ™¯
                  color: '#FF6B35', // æ·±æ©™è‰²æ–‡å­—
                  fontWeight: '600',
                },
              ]}
            >
              {part}
            </Text>
          ) : (
            <Text key={index}>{part}</Text>
          );
        })}
      </Text>
    );
  } catch (error) {
    // æ­£åˆ™è¡¨è¾¾å¼é”™è¯¯æ—¶ï¼Œæ˜¾ç¤ºåŸæ–‡
    console.warn('HighlightedText é”™è¯¯:', error);
    return (
      <Text style={style} numberOfLines={numberOfLines}>
        {text}
      </Text>
    );
  }
}
```

---

### æ­¥éª¤ 5: åœ¨æ—¥è®°å¡ç‰‡ä¸­ä½¿ç”¨é«˜äº®

#### æ–‡ä»¶: `mobile/src/screens/DiaryListScreen.tsx`

**ä½ç½®**: åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ å¯¼å…¥

```typescript
import { HighlightedText } from "../components/HighlightedText";
```

**ä½ç½®**: ä¿®æ”¹ `renderDiaryCard` å‡½æ•°ä¸­çš„æ ‡é¢˜æ˜¾ç¤ºï¼ˆçº¦ç¬¬1537-1550è¡Œï¼‰

**åŸä»£ç **:

```typescript
<Text
  style={[
    styles.cardTitle,
    {
      fontFamily: titleFontFamily,
      fontWeight: isChineseTitle ? '700' : '600',
      fontSize: isChineseTitle ? 18 : 18,
      lineHeight: isChineseTitle ? 26 : 24,
    },
  ]}
  numberOfLines={2}
>
  {item.title}
</Text>
```

**æ›¿æ¢ä¸º**:

```typescript
<HighlightedText
  text={item.title}
  searchQuery={searchQuery}
  style={[
    styles.cardTitle,
    {
      fontFamily: titleFontFamily,
      fontWeight: isChineseTitle ? '700' : '600',
      fontSize: isChineseTitle ? 18 : 18,
      lineHeight: isChineseTitle ? 26 : 24,
    },
  ]}
  numberOfLines={2}
/>
```

**ä½ç½®**: ä¿®æ”¹å†…å®¹æ˜¾ç¤ºï¼ˆçº¦ç¬¬1570-1580è¡Œï¼‰

**åŸä»£ç **:

```typescript
<Text
  style={[
    styles.cardContent,
    {
      fontFamily: contentFontFamily,
      fontSize: isChineseContent ? 16 : 16,
      lineHeight: isChineseContent ? 28 : 24,
    },
  ]}
  numberOfLines={3}
>
  {contentText}
</Text>
```

**æ›¿æ¢ä¸º**:

```typescript
<HighlightedText
  text={contentText}
  searchQuery={searchQuery}
  style={[
    styles.cardContent,
    {
      fontFamily: contentFontFamily,
      fontSize: isChineseContent ? 16 : 16,
      lineHeight: isChineseContent ? 28 : 24,
    },
  ]}
  numberOfLines={3}
/>
```

---

### æ­¥éª¤ 6: æ·»åŠ å›½é™…åŒ–æ–‡æœ¬

#### æ–‡ä»¶: `mobile/src/i18n/zh.ts`

**ä½ç½®**: åœ¨ exports å¯¹è±¡ä¸­æ·»åŠ ï¼ˆçº¦ç¬¬150è¡Œé™„è¿‘ï¼‰

```typescript
search: {
  placeholder: 'æœç´¢æ—¥è®°...',
  searching: 'æœç´¢ä¸­...',
  noResults: 'æœªæ‰¾åˆ°åŒ¹é…çš„æ—¥è®°',
  found: 'æ‰¾åˆ°',
  results: 'æ¡æ—¥è®°',
},
```

#### æ–‡ä»¶: `mobile/src/i18n/en.ts`

```typescript
search: {
  placeholder: 'Search diaries...',
  searching: 'Searching...',
  noResults: 'No matching diaries found',
  found: 'Found',
  results: 'diaries',
},
```

---

## åç«¯å®ç°

### æ–‡ä»¶: `backend/app/routers/diary.py`

**ä½ç½®**: åœ¨æ–‡ä»¶æœ«å°¾ï¼Œæœ€åä¸€ä¸ªè·¯ç”±ä¹‹åæ·»åŠ 

```python
@router.get("/search")
async def search_diaries(
    q: str = Query(..., min_length=1, max_length=100, description="æœç´¢å…³é”®è¯"),
    current_user: dict = Depends(get_current_user),
):
    """
    æœç´¢æ—¥è®°

    - æ”¯æŒæ ‡é¢˜å’Œå†…å®¹çš„å…¨æ–‡æœç´¢
    - æ”¯æŒä¸­è‹±æ–‡æ¨¡ç³ŠåŒ¹é…
    - æŒ‰åˆ›å»ºæ—¶é—´å€’åºè¿”å›ç»“æœ

    TODO: ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨ ElasticSearch æˆ– DynamoDB GSI ä¼˜åŒ–æ€§èƒ½
    """
    try:
        user_id = current_user["user_id"]
        logger.info(f"ç”¨æˆ· {user_id} æœç´¢: {q}")

        # ä½¿ç”¨ DynamoDB scan è¿›è¡Œå…¨æ–‡æœç´¢
        # æ³¨æ„ï¼šscan ä¼šæ‰«ææ•´ä¸ªè¡¨ï¼Œå¯¹äºå¤§æ•°æ®é‡æ•ˆç‡è¾ƒä½
        # ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ ElasticSearch æˆ–åˆ›å»º GSI

        response = diary_table.scan(
            FilterExpression=(
                Attr("user_id").eq(user_id) &
                (
                    Attr("title").contains(q) |
                    Attr("polished_content").contains(q) |
                    Attr("original_content").contains(q)
                )
            )
        )

        diaries = response.get("Items", [])

        # æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åº
        diaries.sort(key=lambda x: x.get("created_at", ""), reverse=True)

        logger.info(f"æœç´¢åˆ° {len(diaries)} æ¡æ—¥è®°")

        return {
            "diaries": diaries,
            "count": len(diaries)
        }

    except Exception as e:
        logger.error(f"æœç´¢æ—¥è®°å¤±è´¥: {str(e)}")
        raise HTTPException(
            status_code=500,
            detail=f"æœç´¢å¤±è´¥: {str(e)}"
        )
```

**é‡è¦**: ç¡®ä¿é¡¶éƒ¨å·²å¯¼å…¥å¿…è¦çš„æ¨¡å—

```python
from fastapi import Query  # æ·»åŠ åˆ°ç°æœ‰çš„ fastapi å¯¼å…¥ä¸­
from boto3.dynamodb.conditions import Attr  # æ·»åŠ åˆ°ç°æœ‰çš„ boto3 å¯¼å…¥ä¸­
```

---

## æµ‹è¯•æ¸…å•

### å‰ç«¯æµ‹è¯•

- [ ] **æœç´¢æ¡†æ˜¾ç¤ºæ­£å¸¸**
  - iOS å’Œ Android ä¸ŠUIæ­£å¸¸
  - è¾“å…¥æ¡†å¯ä»¥æ­£å¸¸è¾“å…¥ä¸­è‹±æ–‡
  - æ¸…ç©ºæŒ‰é’®å·¥ä½œæ­£å¸¸

- [ ] **æœ¬åœ°æœç´¢åŠŸèƒ½**
  - æœç´¢ä¸­æ–‡å†…å®¹èƒ½æ‰¾åˆ°æ—¥è®°
  - æœç´¢è‹±æ–‡å†…å®¹èƒ½æ‰¾åˆ°æ—¥è®°
  - æœç´¢æ ‡é¢˜èƒ½æ‰¾åˆ°æ—¥è®°
  - æœç´¢å†…å®¹èƒ½æ‰¾åˆ°æ—¥è®°
  - å¤§å°å†™ä¸æ•æ„Ÿ

- [ ] **æœç´¢ä½“éªŒ**
  - è¾“å…¥åœæ­¢å300mså¼€å§‹æœç´¢
  - æ˜¾ç¤º"æœç´¢ä¸­..."æç¤º
  - æ˜¾ç¤ºæœç´¢ç»“æœæ•°é‡
  - æ— ç»“æœæ—¶æ˜¾ç¤ºæç¤º
  - æ¸…ç©ºæœç´¢åæ¢å¤å®Œæ•´åˆ—è¡¨

- [ ] **æœç´¢ç»“æœ**
  - ç»“æœæŒ‰æ—¶é—´å€’åºæ’åˆ—
  - ç‚¹å‡»æœç´¢ç»“æœå¯ä»¥æ­£å¸¸æ‰“å¼€è¯¦æƒ…
  - å…³é”®è¯é«˜äº®æ˜¾ç¤ºæ­£ç¡®
  - é«˜äº®é¢œè‰²æ¸…æ™°å¯è§

- [ ] **è¾¹ç•Œæƒ…å†µ**
  - ç‰¹æ®Šå­—ç¬¦æœç´¢ä¸å´©æºƒ
  - emojiæœç´¢ä¸å´©æºƒ
  - ç©ºæ ¼æœç´¢æ­£å¸¸
  - ç½‘ç»œæ–­å¼€æ—¶é™çº§åˆ°æœ¬åœ°æœç´¢

### åç«¯æµ‹è¯•

- [ ] **APIç«¯ç‚¹**
  - `/api/diary/search?q=æµ‹è¯•` è¿”å›200
  - è¿”å›æ•°æ®æ ¼å¼æ­£ç¡®
  - åªè¿”å›å½“å‰ç”¨æˆ·çš„æ—¥è®°

- [ ] **æœç´¢å‡†ç¡®æ€§**
  - ä¸­æ–‡æœç´¢å‡†ç¡®
  - è‹±æ–‡æœç´¢å‡†ç¡®
  - éƒ¨åˆ†åŒ¹é…æœ‰æ•ˆ
  - ç»“æœæŒ‰æ—¶é—´æ’åº

- [ ] **æ€§èƒ½**
  - æœç´¢å“åº” < 1ç§’
  - å¤§æ•°æ®é‡ä¸è¶…æ—¶

- [ ] **å®‰å…¨æ€§**
  - éœ€è¦è®¤è¯æ‰èƒ½è®¿é—®
  - XSSæ³¨å…¥æ— æ•ˆ
  - SQLæ³¨å…¥æ— æ•ˆ

---

## å·²çŸ¥é—®é¢˜ä¸ä¼˜åŒ–å»ºè®®

### å½“å‰é™åˆ¶

1. **DynamoDB Scan æ€§èƒ½é—®é¢˜**
   - å½“å‰ä½¿ç”¨ `scan` å…¨è¡¨æ‰«æ
   - ç”¨æˆ·æ—¥è®° > 1000 æ¡æ—¶æ€§èƒ½ä¸‹é™
   - **å»ºè®®**: ä½¿ç”¨ ElasticSearch æˆ–åˆ›å»º DynamoDB GSI

2. **æœç´¢ç»“æœåˆ†é¡µ**
   - å½“å‰ä¸€æ¬¡è¿”å›æ‰€æœ‰ç»“æœ
   - ç»“æœå¤ªå¤šæ—¶å¯èƒ½å¡é¡¿
   - **å»ºè®®**: æ·»åŠ åˆ†é¡µï¼Œæ¯æ¬¡è¿”å›50æ¡

3. **æœç´¢å†å²**
   - å½“å‰ä¸ä¿å­˜æœç´¢å†å²
   - **å»ºè®®**: æ·»åŠ æœ€è¿‘æœç´¢åŠŸèƒ½

### æœªæ¥ä¼˜åŒ–

1. **é«˜çº§æœç´¢**
   - æŒ‰æ—¥æœŸèŒƒå›´æœç´¢
   - æŒ‰æƒ…ç»ªæœç´¢
   - æŒ‰æ ‡ç­¾æœç´¢

2. **æœç´¢å»ºè®®**
   - çƒ­é—¨æœç´¢è¯
   - æœç´¢è‡ªåŠ¨å®Œæˆ
   - æ‹¼å†™çº æ­£

3. **æœç´¢åˆ†æ**
   - è®°å½•æœç´¢è¡Œä¸º
   - ä¼˜åŒ–æœç´¢ç®—æ³•
   - ä¸ªæ€§åŒ–æœç´¢ç»“æœ

---

## å®æ–½æ­¥éª¤

### Day 1: å‰ç«¯UI (2-3å°æ—¶)

1. âœ… æ·»åŠ æœç´¢æ¡† UI
2. âœ… æ·»åŠ å›½é™…åŒ–æ–‡æœ¬
3. âœ… æµ‹è¯•UIåœ¨ä¸åŒè®¾å¤‡ä¸Šçš„æ˜¾ç¤º

### Day 2: å‰ç«¯é€»è¾‘ (3-4å°æ—¶)

1. âœ… å®ç°æœ¬åœ°æœç´¢
2. âœ… æ·»åŠ é˜²æŠ–
3. âœ… åˆ›å»ºé«˜äº®ç»„ä»¶
4. âœ… é›†æˆåˆ°æ—¥è®°å¡ç‰‡

### Day 3: åç«¯API (2-3å°æ—¶)

1. âœ… å®ç°æœç´¢ç«¯ç‚¹
2. âœ… æµ‹è¯•API
3. âœ… å‰åç«¯è”è°ƒ

### Day 4: æµ‹è¯•ä¼˜åŒ– (2-3å°æ—¶)

1. âœ… å®Œæ•´åŠŸèƒ½æµ‹è¯•
2. âœ… æ€§èƒ½æµ‹è¯•
3. âœ… Bugä¿®å¤
4. âœ… ä»£ç å®¡æŸ¥

---

## æäº¤æ¸…å•

æäº¤å‰ç¡®è®¤:

- [ ] æ‰€æœ‰æ–‡ä»¶å·²ä¿å­˜
- [ ] TypeScript æ— ç¼–è¯‘é”™è¯¯
- [ ] ä»£ç æ ¼å¼åŒ–å®Œæˆ
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] Commit message æ¸…æ™°

```bash
git add .
git commit -m "feat: implement diary search functionality

- Add search UI with real-time input
- Implement local and backend search
- Add search result highlighting
- Support Chinese and English fuzzy matching
- Add debouncing (300ms)
- Backend search API with DynamoDB scan

Tested on iOS and Android"
```

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹å®ç°ï¼** ğŸš€

æœ‰ä»»ä½•é—®é¢˜éšæ—¶é—®æˆ‘ï¼
